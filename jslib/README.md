**Version: 0.1.0**

Last modified: 20 November 2015

# JavaScript API Wrappers for the Data API

The JavaScript Data API is, like the Python API, custom wrapper code on top of the JavaScript library generated by Thrift. The source code for these wrappers is in `jslib/src/js/`.

## Installation

1. Clone the GitHub repository

    Follow instructions at: https://github.com/kbase/data_api, basically:

        git clone https://github.com/kbase/data_api.git

    Change directory to the top-level of the newly cloned repository when it completes.

        cd data_api

2. (Optional; for core development) Install Python API and scripts. This will also build, and allow you to re-build, the Thrift stubs. There are two steps here, first installing Thrift itself and then installing Python libraries using the standard method (running the `setup.py` script).

    a. Install Thrift. You can install from source on any platform. See the [Thrift homepage](https://thrift.apache.org/). On Mac OSX, you can use homebrew and simply do `brew install thrift`.
    
    b. Install the Python library. The simplest thing to do here is, from the top-level directory of the repo, run the command `python setup.py install`. That is really only sensible if you are in a virtual environment, which means that you use [virtualenv/virtualenvwrapper](http://virtualenvwrapper.readthedocs.org/en/latest/) or [anaconda](https://www.continuum.io/downloads) to create one first.

3. Update JavaScript dependencies

    a. Change to the `jslib` directory and run the Node Package Manager (npm). 
    This downloads and installs a bunch of things, so it will take a couple of 
    minutes the first time, and create many screenfulls of output.

        cd jslib
        npm install

    If you have run `npm install` before, and there is nothing to do, you may just see a warning like "npm WARN package.json kbase-data-api-js@0.0.1 No repository field.". This is normal and harmless and you can ignore it.
    
    b. Change to the top-level directory and run "bower" to update JS libraries. Again, you will get some output, but this should run much faster than the previous step.
    
        cd ..
        bower update

4. Build JavaScript library. Change back down to the `jslib` directory and build the libraries with "grunt". Repeat this step every time you make changes to the local code.
    
        cd jslib
        grunt build
    
## Testing

All the JavaScript tests and tools, unless otherwise stated, should be run from the same directory as this README, currently called `jslib`.

We use [Karma](https://karma-runner.github.io) to run the JavaScript code. Tests run against the following browsers/platforms:
    * chrome
    * safari  --- EEK! not working yet!!
    * firefox

The Karma configuration is under `test/karma.conf.js`. You shouldn't need to modify it, except perhaps for the "port:" setting if the default port conflicts with something else on your system.

Tests themselves are in `test/spec` and are usually named `test_<type>_api.js`, where "<type>" is the API name, e.g., `test_taxon_api.js`.

### Running the tests

* Install Karma

        npm install -g karma karma-cli
    

* Also install the "corsproxy" npm module. This handles the CORS issues the browsers otherwise will choke on.

        npm install -g corsproxy
        
      
* Run the corsproxy on port 8000

        CORSPROXY_PORT=8000 corsproxy &

 
* Run the Data API service of choice -- here, Taxon -- using the configuration in `data_api-test.cfg`

        data_api_start_service.py --config data_api-test.cfg --kbase_url test --service taxon &
        
    You can add `-v` for very verbose messages to stderr.

* From the same directory, run the Karma tests

        karma start test/karam.conf.js

### TravisCI

For development, we also use TravisCI. The configuration for the TravisCI tests is in the usual place, `.travis.yml` in the top-level directory. If any of the above steps don't work, you can look there and see if it's doing something different; if so, then that's probably the _real_ procedure and this document is out of date (please [report it](http://kbase.us/contact-us/) as a bug!).